# Feature: Task 4.3.1 - Type Definition Extractor

## Overview

Create a type definition extractor that extracts @type, @typep, and @opaque definitions from AST, including type name, arity, parameters, and the type expression structure.

## Problem Statement

Elixir type definitions come in three visibility levels:
1. `@type` - Public type definitions
2. `@typep` - Private type definitions
3. `@opaque` - Opaque type definitions (public but implementation hidden)

Each type definition has:
- A type name
- Optional type parameters (arity)
- A type expression defining the structure

The extractor needs to:
1. Detect type definition attributes
2. Extract type name and arity
3. Extract type parameters as type variables
4. Preserve the type expression for further parsing

## Ontology Classes to Support

From `elixir-structure.ttl`:
- `TypeDefinition` - Base class for type definitions
- `PublicType`, `PrivateType`, `OpaqueType` - Visibility subclasses
- `TypeVariable` - Type parameters in parametric types
- `typeName`, `typeArity` properties

## Implementation Plan

### Step 1: Create Type Definition Extractor Module
- [x] Create `lib/elixir_ontologies/extractors/type_definition.ex`
- [x] Define `TypeDefinition` result struct
- [x] Add type detection: `type_definition?/1`

### Step 2: Implement TypeDefinition.extract/2
- [x] Accept @type/@typep/@opaque AST and optional context
- [x] Return `{:ok, %TypeDefinition{}}` or `{:error, reason}`
- [x] Add `extract!/2` that raises on error

### Step 3: Extract Type Identity
- [x] Extract type name from definition
- [x] Calculate arity from type parameters
- [x] Determine visibility from attribute type

### Step 4: Extract Type Parameters
- [x] Detect parameterized types `@type t(a, b) :: ...`
- [x] Extract type variables as list
- [x] Handle non-parameterized types

### Step 5: Extract Type Expression
- [x] Preserve the right-hand side type expression
- [x] Handle basic types (atom(), integer(), etc.)
- [x] Handle compound types (unions, tuples, etc.)

### Step 6: Bulk Extraction
- [x] Add `extract_all/1` for module body
- [x] Filter type definition attributes
- [x] Return list of TypeDefinition structs

### Step 7: Write Tests
- [x] Test @type extraction
- [x] Test @typep extraction
- [x] Test @opaque extraction
- [x] Test parameterized type extraction
- [x] Test type expression preservation

## Result Struct Design

```elixir
%TypeDefinition{
  name: atom(),
  arity: non_neg_integer(),
  visibility: :public | :private | :opaque,
  parameters: [atom()],
  expression: Macro.t(),
  location: SourceLocation.t() | nil,
  metadata: %{
    attribute: :type | :typep | :opaque,
    is_parameterized: boolean()
  }
}
```

## Success Criteria

- [x] All 8 subtasks from plan completed
- [x] At least 10 tests passing (as specified in plan) - 60 tests (20 doctests + 40 unit tests)
- [x] Doctests for all public functions
- [x] Dialyzer passes with no errors
- [x] Consistent with other extractor patterns

## Files to Create/Modify

### Create
- `lib/elixir_ontologies/extractors/type_definition.ex` - Main extractor
- `test/elixir_ontologies/extractors/type_definition_test.exs` - Test file

### Modify
- `notes/planning/phase-04.md` - Mark task 4.3.1 complete

## Status

- **Current Step:** Complete
- **Tests:** 60 tests (20 doctests + 40 unit tests), 0 failures
- **Dialyzer:** Passes with 0 errors
