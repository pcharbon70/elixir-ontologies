# Feature: Commit Information Extractor (Task 7.1.2)

## Problem Statement

Extend the Git module to extract current commit information for code provenance tracking. This includes commit SHA, tags associated with commits, and commit messages. Source files need to be linked to specific commits via `atCommit` for the elixir-evolution.ttl ontology.

## Solution Overview

Add commit-related functions to the existing `ElixirOntologies.Analyzer.Git` module:
- Create `CommitRef` struct to hold commit metadata
- Implement functions to extract SHA, tags, and messages
- Add commit info to `Repository` struct metadata

## Technical Details

### Files to Modify
- `lib/elixir_ontologies/analyzer/git.ex` - Add commit functions

### Files to Create
- `test/elixir_ontologies/analyzer/git_commit_test.exs` - Commit-specific tests (or extend existing)

### New Struct: CommitRef

```elixir
defmodule CommitRef do
  @type t :: %__MODULE__{
    sha: String.t(),
    short_sha: String.t(),
    message: String.t() | nil,
    tags: [String.t()],
    timestamp: DateTime.t() | nil,
    author: String.t() | nil
  }
end
```

### Functions to Implement

1. `current_commit/1` - Returns full SHA of HEAD
2. `current_commit_short/1` - Returns short (7-char) SHA
3. `commit_tags/1` - Returns list of tags pointing at HEAD
4. `commit_message/1` - Returns commit message
5. `commit_ref/1` - Returns full CommitRef struct
6. `file_commit/2` - Returns SHA of last commit affecting a file

### Git Commands

- `git rev-parse HEAD` - Full SHA
- `git rev-parse --short HEAD` - Short SHA
- `git tag --points-at HEAD` - Tags at current commit
- `git log -1 --format=%s HEAD` - Commit subject
- `git log -1 --format=%B HEAD` - Full commit message
- `git log -1 --format=%aI HEAD` - Author date (ISO 8601)
- `git log -1 --format=%an HEAD` - Author name
- `git log -1 --format=%H -- <file>` - Last commit for file

## Implementation Plan

- [x] 1. Create CommitRef struct
- [x] 2. Implement current_commit/1 returning full SHA
- [x] 3. Implement current_commit_short/1 returning short SHA
- [x] 4. Implement commit_tags/1 returning list of tags
- [x] 5. Implement commit_message/1 returning message
- [x] 6. Implement commit_ref/1 combining all info
- [x] 7. Implement file_commit/2 for per-file tracking
- [x] 8. Update Repository struct to include current commit
- [x] 9. Write tests for all functions
- [x] 10. Run dialyzer

## Success Criteria

- [x] All tests pass (64 total: 20 doctests + 44 unit tests)
- [x] Dialyzer clean
- [x] Works with current repository as test case
- [x] Handles detached HEAD state
- [x] Handles repositories with no tags gracefully

## Current Status

- **What works:** All implementation complete
- **What's next:** Task 7.2.1 Source URL Builder
- **How to run:** `mix test test/elixir_ontologies/analyzer/git_test.exs`
