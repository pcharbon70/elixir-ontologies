# Feature: 6.2.2 Supervision Strategy Extraction

## Problem Statement

Task 6.2.1 implemented Supervisor detection. Task 6.2.2 extends this to extract supervision strategies and child specifications from the `init/1` callback. This allows analyzing supervision tree structure, restart policies, and child process configuration.

## Solution Overview

Extend the Supervisor extractor module with strategy extraction functionality:
1. Parse `init/1` callback return value for supervision strategy
2. Detect strategy atoms (`:one_for_one`, `:one_for_all`, `:rest_for_one`)
3. Extract child specs from children list
4. Extract restart and shutdown strategies from child specs

## Supervision Strategies

| Strategy | Description |
|----------|-------------|
| `:one_for_one` | Only restart the failed child |
| `:one_for_all` | Restart all children on any failure |
| `:rest_for_one` | Restart failed child and all started after it |

## Child Spec Options

| Option | Values | Description |
|--------|--------|-------------|
| `:restart` | `:permanent`, `:temporary`, `:transient` | Restart policy |
| `:shutdown` | integer \| `:infinity` \| `:brutal_kill` | Shutdown timeout |
| `:type` | `:worker` \| `:supervisor` | Child type |

## Technical Details

### File Location
- `lib/elixir_ontologies/extractors/otp/supervisor.ex` - Extend with strategy extraction

### Dependencies
- `ElixirOntologies.Extractors.Helpers` - For location extraction, body normalization

### Detection Patterns

```elixir
# Supervisor.init/2 call with strategy
Supervisor.init(children, strategy: :one_for_one)

# Direct {:ok, {spec, children}} return
{:ok, {{:one_for_one, max_restarts, max_seconds}, children}}

# Child spec tuple
{MyWorker, args}
{MyWorker, args, restart: :temporary}

# Child spec map
%{id: :worker, start: {MyWorker, :start_link, [args]}}
```

### Result Structs

```elixir
defmodule Strategy do
  @type strategy_type :: :one_for_one | :one_for_all | :rest_for_one
  @type t :: %__MODULE__{
    type: strategy_type(),
    max_restarts: non_neg_integer() | nil,
    max_seconds: non_neg_integer() | nil,
    location: SourceLocation.t() | nil,
    metadata: map()
  }
end

defmodule ChildSpec do
  @type restart_type :: :permanent | :temporary | :transient
  @type shutdown_type :: non_neg_integer() | :infinity | :brutal_kill
  @type t :: %__MODULE__{
    id: atom() | term(),
    module: atom() | nil,
    restart: restart_type(),
    shutdown: shutdown_type() | nil,
    type: :worker | :supervisor,
    location: SourceLocation.t() | nil,
    metadata: map()
  }
end
```

## Implementation Plan

- [x] 6.2.2.1 Create Strategy struct
- [x] 6.2.2.2 Create ChildSpec struct
- [x] 6.2.2.3 Add `extract_strategy/1` function to find init/1 and parse return
- [x] 6.2.2.4 Detect `:one_for_one` strategy
- [x] 6.2.2.5 Detect `:one_for_all` strategy
- [x] 6.2.2.6 Detect `:rest_for_one` strategy
- [x] 6.2.2.7 Add `extract_children/1` function to parse children list
- [x] 6.2.2.8 Extract restart strategy from child specs
- [x] 6.2.2.9 Extract shutdown strategy from child specs
- [x] 6.2.2.10 Write comprehensive tests (35 new tests)

## Success Criteria

- [x] Detects `:one_for_one` strategy from init/1
- [x] Detects `:one_for_all` strategy from init/1
- [x] Detects `:rest_for_one` strategy from init/1
- [x] Extracts child specs from children list
- [x] Extracts restart policy from child specs
- [x] Extracts shutdown strategy from child specs
- [x] All tests pass (2004 tests)
- [x] Dialyzer clean (0 errors)

## Current Status

- **What works:** Full implementation complete
- **What's next:** Task 6.3.1 - Agent/Task Extractor
- **How to run:** `mix test test/elixir_ontologies/extractors/otp/supervisor_test.exs`
