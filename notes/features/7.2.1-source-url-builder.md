# Feature: Source URL Builder (Task 7.2.1)

## Problem Statement

Generate source URLs (permalinks) for code elements to enable linking back to the original source code in hosting platforms like GitHub, GitLab, and Bitbucket. This supports the `sourceUrl` property in the elixir-evolution.ttl ontology for code provenance.

## Solution Overview

Create a new `SourceUrl` module that generates platform-specific URLs for files, lines, and line ranges. The module will auto-detect the hosting platform from the repository remote URL and generate appropriate permalinks.

## Technical Details

### Files to Create
- `lib/elixir_ontologies/analyzer/source_url.ex` - URL generation module
- Tests in existing git test file or new file

### URL Formats by Platform

**GitHub:**
- File: `https://github.com/{owner}/{repo}/blob/{sha}/{path}`
- Line: `https://github.com/{owner}/{repo}/blob/{sha}/{path}#L{line}`
- Range: `https://github.com/{owner}/{repo}/blob/{sha}/{path}#L{start}-L{end}`

**GitLab:**
- File: `https://gitlab.com/{owner}/{repo}/-/blob/{sha}/{path}`
- Line: `https://gitlab.com/{owner}/{repo}/-/blob/{sha}/{path}#L{line}`
- Range: `https://gitlab.com/{owner}/{repo}/-/blob/{sha}/{path}#L{start}-{end}`

**Bitbucket:**
- File: `https://bitbucket.org/{owner}/{repo}/src/{sha}/{path}`
- Line: `https://bitbucket.org/{owner}/{repo}/src/{sha}/{path}#lines-{line}`
- Range: `https://bitbucket.org/{owner}/{repo}/src/{sha}/{path}#lines-{start}:{end}`

### Functions to Implement

1. `for_file/3` - Generate URL for a file at a commit
2. `for_line/4` - Generate URL for a specific line
3. `for_range/5` - Generate URL for a line range
4. `detect_platform/1` - Auto-detect platform from host
5. `build_url/2` - Internal URL builder

### Dependencies

- Uses `ElixirOntologies.Analyzer.Git.Repository` struct
- Uses `ElixirOntologies.Analyzer.Git.ParsedUrl` for host detection

## Implementation Plan

- [x] 1. Create source_url.ex module with platform detection
- [x] 2. Implement for_file/5 with GitHub support
- [x] 3. Implement for_line/6 with GitHub support
- [x] 4. Implement for_range/7 with GitHub support
- [x] 5. Add GitLab URL format support
- [x] 6. Add Bitbucket URL format support
- [x] 7. Add auto-detection from Repository struct
- [x] 8. Write tests for all platforms and functions
- [x] 9. Run dialyzer

## Success Criteria

- [x] All tests pass (53 tests - 20 doctests + 33 unit tests)
- [x] Dialyzer clean
- [x] Works with GitHub, GitLab, Bitbucket URLs
- [x] Auto-detects platform from remote URL
- [x] Returns nil gracefully when git info unavailable

## Current Status

- **What works:** All implementation complete
- **What's next:** Task 7.3.1 Path Utilities
- **How to run:** `mix test test/elixir_ontologies/analyzer/source_url_test.exs`
