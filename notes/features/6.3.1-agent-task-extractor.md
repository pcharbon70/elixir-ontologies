# Feature: 6.3.1 Agent/Task Extractor

## Problem Statement

Task 6.3.1 requires implementing an extractor for Agent and Task OTP patterns. This extends the OTP extraction capabilities to cover:
- Agent module detection (`use Agent`, `@behaviour Agent`)
- Task function call detection (`Task.async`, `Task.start`, `Task.start_link`)
- Task.Supervisor usage detection

This supports the OTP-related classes from elixir-otp.ttl for Agent and Task constructs.

## Solution Overview

Create a new extractor module `lib/elixir_ontologies/extractors/otp/agent_task.ex` that:
1. Detects Agent module implementations
2. Detects Task usage patterns via function calls
3. Detects Task.Supervisor usage
4. Follows the established pattern from GenServer/Supervisor extractors

## Technical Details

### File Location
- `lib/elixir_ontologies/extractors/otp/agent_task.ex` - Main extractor
- `test/elixir_ontologies/extractors/otp/agent_task_test.exs` - Tests

### Dependencies
- `ElixirOntologies.Extractors.Helpers` - For location extraction, body normalization

### Detection Patterns

#### Agent Detection
```elixir
# use Agent
use Agent

# @behaviour Agent
@behaviour Agent

# Agent function calls
Agent.start_link(fn -> state end)
Agent.get(agent, fn state -> state end)
Agent.update(agent, fn state -> new_state end)
```

#### Task Detection
```elixir
# Task function calls
Task.async(fn -> result end)
Task.start(fn -> :ok end)
Task.start_link(fn -> :ok end)
Task.await(task)
Task.yield(task)

# Task module (rare, but possible)
use Task
```

#### Task.Supervisor Detection
```elixir
# use Task.Supervisor
use Task.Supervisor

# Task.Supervisor function calls
Task.Supervisor.async(supervisor, fn -> result end)
Task.Supervisor.start_child(supervisor, fn -> result end)
```

### Result Structs

```elixir
# Agent extraction result
%Agent{
  detection_method: :use | :behaviour | :function_call,
  use_options: keyword() | nil,
  function_calls: [AgentCall.t()],
  location: SourceLocation.t() | nil,
  metadata: map()
}

# Task extraction result
%Task{
  type: :task | :task_supervisor,
  function_calls: [TaskCall.t()],
  location: SourceLocation.t() | nil,
  metadata: map()
}

# Function call tracking
%AgentCall{
  function: :start_link | :get | :update | :get_and_update | :cast | :stop,
  location: SourceLocation.t() | nil
}

%TaskCall{
  function: :async | :start | :start_link | :await | :yield | :async_stream,
  supervised: boolean(),
  location: SourceLocation.t() | nil
}
```

## Implementation Plan

- [x] 1. Create agent_task.ex with Agent struct and detection
- [x] 2. Implement Agent detection (use Agent, @behaviour Agent)
- [x] 3. Implement Agent function call detection
- [x] 4. Create Task struct and detection
- [x] 5. Implement Task function call detection
- [x] 6. Implement Task.Supervisor detection
- [x] 7. Write comprehensive tests (72 tests - 54 unit + 18 doctests)
- [x] 8. Run tests and dialyzer
- [x] 9. Update phase plan

## Success Criteria

- [x] Detects `use Agent` in module bodies
- [x] Detects `@behaviour Agent` declarations
- [x] Detects `Task.async/1` and `Task.async/3` calls
- [x] Detects `Task.start/1` and `Task.start_link/1` calls
- [x] Detects `Task.Supervisor` usage
- [x] All tests pass (2058 tests total)
- [x] Dialyzer clean (0 errors)

## Current Status

- **What works:** Full implementation complete
- **What's next:** Task 6.4.1 - ETS Table Extractor
- **How to run:** `mix test test/elixir_ontologies/extractors/otp/agent_task_test.exs`
