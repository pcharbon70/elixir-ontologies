# Feature: Source URL Builder Review Fixes

## Problem Statement

Address all concerns and implement suggested improvements from the code review of task 7.2.1 Source URL Builder.

## Review Findings to Address

### Concerns (Priority 1)
1. **URL encoding missing** - Paths with special characters won't work
2. **Platform detection too permissive** - Substring matching could misclassify hosts
3. **Missing line range validation** - Accepts `start > end`
4. **Path traversal not fully mitigated** - `../` sequences pass through

### Suggestions (Priority 2)
5. **Add commit format validation** - Prevent URL fragment/query injection (deferred - low risk for current use case)
6. **Add upper bound for line numbers** - Prevent absurd values
7. **Complete documentation for overloaded functions** - Add full docs
8. **Add missing no_name test case** - Complete test coverage

## Implementation Plan

- [x] 1. Add URL encoding for path components in `normalize_path/1`
- [x] 2. Strengthen platform detection with domain suffix matching
- [x] 3. Add `start_line <= end_line` guard to `for_range/7`
- [x] 4. Add path traversal prevention (remove `..` sequences, collapse slashes)
- [x] 5. Add upper bound for line numbers (1,000,000)
- [x] 6. Complete documentation for `for_line/3` and `for_range/4`
- [x] 7. Add missing `no_name` test case
- [x] 8. Write tests for new validations
- [x] 9. Run tests and dialyzer

## Success Criteria

- [x] All tests pass (79 tests: 23 doctests + 56 unit tests)
- [x] Dialyzer clean
- [x] URL encoding works for special characters
- [x] Platform detection stricter
- [x] Invalid line ranges rejected
- [x] Path traversal prevented

## Current Status

- **What works:** All review fixes implemented and tested
- **What's next:** Merge to develop
- **How to run:** `mix test test/elixir_ontologies/analyzer/source_url_test.exs`
