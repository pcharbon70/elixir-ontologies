# Feature 2.2.1: AST Walker Module

## Problem Statement

The analyzer needs to traverse Elixir AST to collect information for RDF generation. We need a generic AST walking infrastructure that:
1. Visits all nodes in the AST tree
2. Supports both pre-order and post-order traversal callbacks
3. Tracks traversal context (depth, parent chain)
4. Allows selective walking (skipping subtrees)
5. Provides pattern-based node collection

## Solution Overview

Create an `ASTWalker` module that wraps custom traversal logic with:
1. A context struct tracking depth, parent chain, and path
2. Pre-order and post-order visitor callbacks
3. Skip and halt mechanisms for selective traversal
4. Convenience functions for common patterns (find_all, collect)

## Technical Details

### File Location
`lib/elixir_ontologies/analyzer/ast_walker.ex`

### Dependencies
- Elixir's standard library only

### API Design

| Function | Description |
|----------|-------------|
| `walk/3` | Walk AST with initial accumulator and visitor function or options |
| `find_all/2` | Find all nodes matching a predicate |
| `find_all/3` | Find all nodes matching predicate with context |
| `collect/3` | Collect transformed values from matching nodes |
| `depth_of/2` | Find depth of a specific node |
| `count_nodes/1` | Count total nodes in AST |
| `max_depth/1` | Find maximum depth of AST |

### Context Struct

```elixir
%ASTWalker.Context{
  depth: non_neg_integer(),     # Current depth in tree (0 = root)
  path: [atom()],               # Path of node types from root
  parent: Macro.t() | nil,      # Parent node (nil at root)
  parents: [Macro.t()]          # Full parent chain from root
}
```

### Visitor Return Values

The visitor function can return:
- `{:cont, new_acc}` - Continue traversal with updated accumulator
- `{:skip, new_acc}` - Skip children of current node
- `{:halt, new_acc}` - Stop entire traversal

### Options

| Option | Default | Description |
|--------|---------|-------------|
| `:pre` | `nil` | Pre-order visitor `(node, context, acc) -> result` |
| `:post` | `nil` | Post-order visitor `(node, context, acc) -> result` |

## Implementation Plan

- [x] 2.2.1.1 Create `lib/elixir_ontologies/analyzer/ast_walker.ex`
- [x] 2.2.1.2 Implement `ASTWalker.walk/3` with AST, initial_acc, and visitor function
- [x] 2.2.1.3 Implement pre-order and post-order callbacks
- [x] 2.2.1.4 Support selective walking (skip subtrees)
- [x] 2.2.1.5 Track depth and parent chain during traversal
- [x] 2.2.1.6 Implement `ASTWalker.find_all/2` for pattern-based collection
- [x] 2.2.1.7 Write walker tests

## Success Criteria

- [x] All functions implemented with proper typespecs
- [x] Comprehensive documentation with examples
- [x] Tests covering:
  - Walking all nodes in AST
  - Pre-order and post-order callbacks
  - Skip and halt behaviors
  - Depth tracking accuracy
  - Parent chain tracking
  - find_all with various predicates
- [x] Context struct correctly maintained during traversal

## Current Status

**Status**: Complete

### What Works
- Feature branch created: `feature/2.2.1-ast-walker`
- Planning document created
- ASTWalker module implemented with full API
- Context struct with depth, path, parent, parents tracking
- 42 tests passing (33 unit + 9 doctests)

### Functions Implemented
- `walk/3` - Walk AST with visitor or options
- `find_all/2,3` - Find nodes matching predicate
- `collect/3` - Collect transformed values from matches
- `depth_of/2` - Find depth of specific node
- `count_nodes/1` - Count total nodes
- `max_depth/1` - Find max depth

### How to Run
```bash
mix test test/elixir_ontologies/analyzer/ast_walker_test.exs
```
