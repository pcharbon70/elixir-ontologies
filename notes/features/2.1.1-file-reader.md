# Feature 2.1.1: File Reader Module

## Problem Statement

The analyzer needs to read Elixir source files reliably, handling encoding issues and providing metadata about the files. This is the foundation for all AST parsing operations.

## Solution Overview

Create a `FileReader` module that:
1. Reads source files with proper encoding handling
2. Detects and handles UTF-8 BOM
3. Provides file metadata (path, size, mtime)
4. Returns consistent ok/error tuples

## Technical Details

### File Location
`lib/elixir_ontologies/analyzer/file_reader.ex`

### Dependencies
- Standard Elixir `File` module
- No external dependencies needed

### API Design

| Function | Description |
|----------|-------------|
| `read/1` | Read file, return `{:ok, %FileReader.Result{}}` or `{:error, reason}` |
| `read!/1` | Read file, raise on error |
| `exists?/1` | Check if file exists |
| `elixir_file?/1` | Check if file has .ex or .exs extension |

### Result Struct

```elixir
%FileReader.Result{
  path: String.t(),           # Absolute path to file
  source: String.t(),         # File contents (UTF-8)
  size: non_neg_integer(),    # File size in bytes
  mtime: NaiveDateTime.t()    # Last modification time
}
```

### Error Handling

| Error | Return Value |
|-------|--------------|
| File not found | `{:error, :enoent}` |
| Permission denied | `{:error, :eacces}` |
| Not a regular file | `{:error, :not_regular_file}` |
| Encoding error | `{:error, {:encoding_error, details}}` |

### UTF-8 BOM Handling

The UTF-8 BOM (Byte Order Mark) is the byte sequence `0xEF 0xBB 0xBF` at the start of a file. While valid UTF-8, it can cause issues with Elixir's parser. The FileReader will:
1. Detect BOM at file start
2. Strip BOM from source content
3. Continue processing normally

## Implementation Plan

- [x] 2.1.1.1 Create `lib/elixir_ontologies/analyzer/file_reader.ex`
- [x] 2.1.1.2 Implement `FileReader.read/1` returning `{:ok, result}` or `{:error, reason}`
- [x] 2.1.1.3 Handle UTF-8 encoding with BOM detection
- [x] 2.1.1.4 Implement `FileReader.read!/1` raising on error
- [x] 2.1.1.5 Track file metadata (path, size, mtime)
- [x] 2.1.1.6 Write file reader tests (31 tests - 22 unit + 9 doctests)

## Success Criteria

- [x] All functions implemented with proper typespecs
- [x] Comprehensive documentation with examples
- [x] 31 tests covering all operations
- [x] Error handling returns clear, actionable messages
- [x] UTF-8 BOM is properly detected and stripped

## Current Status

**Status**: Complete

### What Works
- Feature branch created: `feature/2.1.1-file-reader`
- Planning document created
- FileReader module implemented with full API
- 31 tests passing (22 unit + 9 doctests)

### Functions Implemented
- `read/1` - Read file with metadata
- `read!/1` - Bang variant
- `exists?/1` - Check file existence
- `elixir_file?/1` - Check Elixir extension
- `has_bom?/1` - Check for UTF-8 BOM

### How to Run
```bash
mix test test/elixir_ontologies/analyzer/file_reader_test.exs
```
