# Feature: 6.4.1 ETS Table Extractor

## Problem Statement

Task 6.4.1 requires implementing an extractor for ETS (Erlang Term Storage) table definitions and usage. ETS provides in-memory storage for Erlang/Elixir terms with O(1) lookup. This extractor will detect:
- `:ets.new/2` table creation calls
- Table types (set, ordered_set, bag, duplicate_bag)
- Access types (public, protected, private)
- Concurrency options (read_concurrency, write_concurrency)
- Named vs unnamed tables

## Solution Overview

Create a new extractor module `lib/elixir_ontologies/extractors/otp/ets.ex` that:
1. Detects `:ets.new/2` calls in module bodies
2. Extracts table name from first argument
3. Parses options to determine table type, access, and concurrency settings
4. Follows the established pattern from other OTP extractors

## Technical Details

### File Location
- `lib/elixir_ontologies/extractors/otp/ets.ex` - Main extractor
- `test/elixir_ontologies/extractors/otp/ets_test.exs` - Tests

### Dependencies
- `ElixirOntologies.Extractors.Helpers` - For location extraction, body normalization

### ETS Table Types

| Type | Description |
|------|-------------|
| `:set` | Unique keys, one value per key (default) |
| `:ordered_set` | Unique keys, ordered by key |
| `:bag` | Multiple objects per key, but identical objects not allowed |
| `:duplicate_bag` | Multiple identical objects per key allowed |

### ETS Access Types

| Access | Description |
|--------|-------------|
| `:protected` | Owner can read/write, others can read (default) |
| `:public` | Any process can read/write |
| `:private` | Only owner can read/write |

### Detection Patterns

```elixir
# Basic ETS creation
:ets.new(:my_table, [:set, :public])

# With named_table option
:ets.new(:my_table, [:named_table, :set, :public])

# With concurrency options
:ets.new(:my_table, [:set, :public, read_concurrency: true, write_concurrency: true])

# Ordered set
:ets.new(:my_table, [:ordered_set, :private])

# Bag types
:ets.new(:my_table, [:bag, :protected])
:ets.new(:my_table, [:duplicate_bag, :protected])
```

### Result Struct

```elixir
%ETSTable{
  name: atom() | nil,
  table_type: :set | :ordered_set | :bag | :duplicate_bag,
  access_type: :public | :protected | :private,
  named_table: boolean(),
  read_concurrency: boolean(),
  write_concurrency: boolean(),
  compressed: boolean(),
  heir: term() | nil,
  location: SourceLocation.t() | nil,
  metadata: map()
}
```

## Implementation Plan

- [x] 1. Create ets.ex with ETSTable struct
- [x] 2. Implement :ets.new/2 detection
- [x] 3. Extract table name from first argument
- [x] 4. Parse table type from options
- [x] 5. Parse access type from options
- [x] 6. Extract concurrency options
- [x] 7. Detect named_table and compressed options
- [x] 8. Write comprehensive tests (77 tests - 55 unit + 22 doctests)
- [x] 9. Run tests and dialyzer
- [x] 10. Update phase plan

## Success Criteria

- [x] Detects `:ets.new/2` calls
- [x] Extracts table name correctly
- [x] Classifies table type (set, ordered_set, bag, duplicate_bag)
- [x] Classifies access type (public, protected, private)
- [x] Extracts read_concurrency and write_concurrency options
- [x] Detects named_table option
- [x] All tests pass (2113 tests total)
- [x] Dialyzer clean (0 errors)

## Current Status

- **What works:** Full implementation complete
- **What's next:** Phase 6 Integration Tests
- **How to run:** `mix test test/elixir_ontologies/extractors/otp/ets_test.exs`
