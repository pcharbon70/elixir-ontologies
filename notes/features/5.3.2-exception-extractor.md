# Feature: 5.3.2 Exception Extractor

## Problem Statement

Extract `defexception` definitions from Elixir AST. Exceptions are a special form of structs with additional exception-specific behavior. This extractor should leverage the existing Struct extractor while adding exception-specific features.

## Solution Overview

Extend the Struct extractor module to handle `defexception`:
1. Detect `defexception` AST patterns
2. Reuse struct field extraction (defexception uses same field syntax)
3. Detect custom `message/1` implementation
4. Track whether exception has default message value

## AST Patterns

### Simple Exception
```elixir
defexception [:message]
# AST: {:defexception, meta, [[:message]]}
```

### Exception with Default Message
```elixir
defexception message: "resource not found"
# AST: {:defexception, meta, [[message: "resource not found"]]}
```

### Exception with Custom message/1
```elixir
defexception [:field, :reason]

@impl true
def message(%{field: f, reason: r}), do: "#{f}: #{r}"
# def pattern matched separately
```

## Technical Details

### Files to Modify
- `lib/elixir_ontologies/extractors/struct.ex` - Add exception support

### Key Design Decision
Since exceptions are a subtype of structs with the same field syntax, we'll extend the existing Struct module rather than creating a separate module. This:
- Avoids code duplication
- Leverages existing field extraction
- Keeps related functionality together

### New Types

```elixir
@type exception :: %{
  fields: [field()],
  enforce_keys: [atom()],
  derives: [Protocol.DeriveInfo.t()],
  has_custom_message: boolean(),
  default_message: String.t() | nil,
  location: SourceLocation.t() | nil,
  metadata: map()
}
```

## Implementation Plan

- [x] Create planning document
- [x] Add `exception?/1` type detection
- [x] Add `extract_exception/2` for defexception extraction
- [x] Add `extract_exception_from_body/2` for module body
- [x] Detect custom `message/1` implementation
- [x] Extract default message value
- [x] Add utility functions (has_custom_message?, default_message)
- [x] Write comprehensive tests
- [x] Run tests and dialyzer
- [x] Update phase plan
- [x] Write summary

## Success Criteria

- [x] All defexception patterns correctly detected
- [x] Fields extracted (reusing struct field logic)
- [x] Custom message/1 detected
- [x] Default message extracted when present
- [x] Tests pass (14 doctests + 24 unit tests)
- [x] Dialyzer clean
- [x] API consistent with struct extraction

## Status

- **Current Step:** Complete
- **Branch:** `feature/5.3.2-exception-extractor`
