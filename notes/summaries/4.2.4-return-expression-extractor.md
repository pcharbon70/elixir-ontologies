# Summary: Task 4.2.4 - Return Expression Extractor

## Overview

Implemented a Return Expression extractor for Phase 4 that extracts the return expression from function bodies, identifying the last expression that determines a function's return value.

## Files Created

### `lib/elixir_ontologies/extractors/return_expression.ex` (~330 lines)

Main extractor module with:

**Result Struct:**
```elixir
%ReturnExpression{
  expression: Macro.t(),
  type: :literal | :variable | :call | :control_flow | :block | :other,
  location: SourceLocation.t() | nil,
  metadata: %{
    multi_return: boolean(),
    control_type: atom() | nil,
    is_nil: boolean()
  }
}
```

**Public API:**
- `extract/2` - Main extraction from function body
- `extract!/2` - Raising variant
- `multi_return?/1` - Check if expression has multiple return paths
- `is_nil_return?/1` - Check if return is nil (bodyless function)
- `control_type/1` - Get control flow type if applicable
- `describe/1` - Get human-readable description

**Expression Types Supported:**
- `:literal` - Atoms, numbers, strings, lists, tuples, maps, structs
- `:variable` - Variable references
- `:call` - Function calls (local and remote)
- `:control_flow` - case, cond, if, unless, with, try, receive
- `:other` - Fallback for any other expressions

**Control Flow Detection:**
- Identifies 7 control flow forms: case, cond, if, unless, with, try, receive
- Flags `multi_return: true` for branching expressions
- Stores `control_type` in metadata

### `test/elixir_ontologies/extractors/return_expression_test.exs` (~380 lines)

Comprehensive test coverage:
- Literal return tests (9 tests)
- Variable return tests
- Function call return tests
- Control flow return tests (7 control types)
- Block return tests
- Nil/empty body tests
- Helper function tests
- Integration tests with `quote`

## Key Implementation Details

1. **Pattern Matching Order:** Specific forms (`:{}, :%{}, :%`) must come before generic function call pattern to avoid misclassification.

2. **Block Handling:** For `{:__block__, _, expressions}`, extracts the last expression recursively.

3. **Multi-Return Detection:** Control flow expressions (case, cond, if, etc.) are flagged as having multiple potential return paths.

4. **Always Succeeds:** The extractor always returns `{:ok, result}` due to fallback pattern, simplifying error handling.

5. **Location Extraction:** Uses `Helpers.extract_location/1` for source position tracking.

## Test Results

- **Total Tests:** 60 (16 doctests + 44 unit tests)
- **Failures:** 0
- **Dialyzer:** Passes with 0 errors
- **Full Suite:** 1841 tests (483 doctests + 23 properties + 1335 tests), 0 failures

## Ontology Alignment

Supports the following from `elixir-structure.ttl`:
- `ReturnExpression` - The expression that a function returns
- `FunctionBody` with `returnsExpression` property

## Relationship to Other Extractors

The Return Expression extractor complements the Clause extractor (4.2.2):
- **Clause extractor:** Extracts function body
- **Return Expression extractor:** Analyzes what the body returns

Together with Function (4.2.1), Clause (4.2.2), and Parameter (4.2.3) extractors, this enables complete function analysis.

## Next Steps

Task 4.2.5 - Guard Extractor:
- Detect `when` clause in function head
- Create `GuardClause` linking to function head
- Extract guard expressions (may be combined with `and`/`or`)
- Link via `hasGuard` property
