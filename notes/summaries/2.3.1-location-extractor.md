# Summary: Task 2.3.1 Location Extractor

## Overview

Implemented the `Location` module for extracting source location information from Elixir AST metadata. This enables tracking where each code element appears in source files, supporting the `hasSourceLocation` RDF property.

## Changes Made

### Created: `lib/elixir_ontologies/analyzer/location.ex`

New module (~485 lines) with 8 public functions:

**Core Extraction Functions:**
| Function | Returns | Description |
|----------|---------|-------------|
| `extract/1` | `{:ok, {line, column}}` or `:no_location` | Get start position from node |
| `extract!/1` | `{line, column}` | Bang variant, raises on missing |
| `extract_range/1` | `{:ok, %SourceLocation{}}` or `:no_location` | Get full range with end position |
| `extract_range!/1` | `%SourceLocation{}` | Bang variant, raises on missing |

**Span Calculation:**
| Function | Returns | Description |
|----------|---------|-------------|
| `span/2` | `{:ok, %SourceLocation{}}` or `:no_location` | Calculate span between two nodes |
| `span!/2` | `%SourceLocation{}` | Bang variant, raises on missing |

**Convenience Functions:**
| Function | Returns | Description |
|----------|---------|-------------|
| `has_location?/1` | `boolean` | Check if node has location metadata |
| `line/1` | `integer` or `nil` | Get start line only |
| `column/1` | `integer` or `nil` | Get start column only |

### SourceLocation Struct

```elixir
defstruct [:start_line, :start_column, :end_line, :end_column]

@type t :: %SourceLocation{
  start_line: pos_integer(),
  start_column: pos_integer(),
  end_line: pos_integer() | nil,
  end_column: pos_integer() | nil
}
```

**Enforced keys**: `start_line`, `start_column`

### Created: `test/elixir_ontologies/analyzer/location_test.exs`

Comprehensive test suite (~460 lines):

| Category | Tests |
|----------|-------|
| extract/1 | 11 tests |
| extract!/1 | 2 tests |
| extract_range/1 | 6 tests |
| extract_range!/1 | 2 tests |
| span/2 | 4 tests |
| span!/2 | 2 tests |
| has_location?/1 | 5 tests |
| line/1 | 5 tests |
| column/1 | 4 tests |
| SourceLocation struct | 3 tests |
| Integration tests | 3 tests |
| Doctests | 17 tests |
| **Total** | **64 tests** |

## Key Features

1. **Robust Metadata Extraction**: Handles various metadata formats:
   - `end` key for block constructs (`defmodule`, `def`)
   - `closing` key for function calls with parentheses
   - `end_of_expression` key for statement boundaries

2. **Graceful Degradation**: Returns `:no_location` for nodes without metadata instead of raising

3. **AST Awareness**: Understands that literal values (atoms, integers, strings) are represented directly, not as tuples with metadata

4. **Span Calculation**: Can calculate the extent from a start node to an end node, useful for compound constructs

## Files Changed

| File | Change |
|------|--------|
| `lib/elixir_ontologies/analyzer/location.ex` | Created - 485 lines |
| `test/elixir_ontologies/analyzer/location_test.exs` | Created - 460 lines |
| `notes/features/2.3.1-location-extractor.md` | Updated to complete |
| `notes/planning/phase-02.md` | Marked task 2.3.1 complete |

## Metrics

| Metric | Value |
|--------|-------|
| New Tests | 64 (17 doctests + 47 unit) |
| Total Project Tests | 620 (128 doctests + 492 unit) |
| Public Functions | 8 |
| Lines Added | ~945 |

## How to Test

```bash
# Run Location tests
mix test test/elixir_ontologies/analyzer/location_test.exs

# Run all tests
mix test
```

## Usage Examples

```elixir
alias ElixirOntologies.Analyzer.Location
alias ElixirOntologies.Analyzer.Location.SourceLocation

# Parse code with location metadata
{:ok, ast} = Code.string_to_quoted("""
defmodule Foo do
  def bar, do: :ok
end
""", columns: true, token_metadata: true)

# Extract start position
{:ok, {line, column}} = Location.extract(ast)
# => {:ok, {1, 1}}

# Extract full range
{:ok, loc} = Location.extract_range(ast)
# => {:ok, %SourceLocation{start_line: 1, start_column: 1, end_line: 3, end_column: 1}}

# Check if node has location
Location.has_location?(ast)  # => true
Location.has_location?(:atom)  # => false

# Convenience functions
Location.line(ast)  # => 1
Location.column(ast)  # => 1
```

## Next Task

The next task in the plan is **2.3.2 End Position Estimation**, which will:
- Implement end line estimation from last child node
- Implement end line estimation from `end` keyword for blocks
- Handle single-line constructs (end_line = start_line)
- Document estimation limitations
