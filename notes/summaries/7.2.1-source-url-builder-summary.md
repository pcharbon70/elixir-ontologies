# Summary: Source URL Builder (Task 7.2.1)

## What Was Done

Implemented source URL generation for code permalinks in Phase 7 (Evolution & Git Integration). This module generates platform-specific URLs for linking to source code in GitHub, GitLab, and Bitbucket.

## Files Created

1. **`lib/elixir_ontologies/analyzer/source_url.ex`** - URL generation module with:
   - `detect_platform/1` - Auto-detect platform from hostname
   - `platform_from_repo/1` - Detect platform from Repository struct
   - `for_file/5` - Generate URL for a file (platform, owner, repo, commit, path)
   - `for_file/2` - Generate URL using Repository struct
   - `for_line/6` - Generate URL for a line (platform, owner, repo, commit, path, line)
   - `for_line/3` - Generate line URL using Repository struct
   - `for_range/7` - Generate URL for line range (platform, owner, repo, commit, path, start, end)
   - `for_range/4` - Generate range URL using Repository struct
   - `url_for_path/2` - Convenience function for current repository

2. **`test/elixir_ontologies/analyzer/source_url_test.exs`** - Comprehensive tests (53 total)

3. **`notes/features/7.2.1-source-url-builder.md`** - Planning document

## URL Formats Supported

| Platform | File | Line | Range |
|----------|------|------|-------|
| GitHub | `/blob/{sha}/{path}` | `#L{line}` | `#L{start}-L{end}` |
| GitLab | `/-/blob/{sha}/{path}` | `#L{line}` | `#L{start}-{end}` |
| Bitbucket | `/src/{sha}/{path}` | `#lines-{line}` | `#lines-{start}:{end}` |

## Test Results

```
20 doctests, 33 tests, 0 failures
Dialyzer: passed successfully
```

## Key Design Decisions

1. **Two API styles** - Direct params (`for_file/5`) and Repository struct (`for_file/2`)
2. **Platform auto-detection** - Detects from hostname substring matching
3. **Graceful nil returns** - Returns nil for unknown platforms or missing data
4. **Path normalization** - Strips leading `/` and `./` from paths
5. **Repository integration** - Works seamlessly with `Git.Repository` struct

## Example Usage

```elixir
# Direct usage
SourceUrl.for_file(:github, "elixir-lang", "elixir", "abc123", "lib/elixir.ex")
# => "https://github.com/elixir-lang/elixir/blob/abc123/lib/elixir.ex"

# With Repository struct
{:ok, repo} = Git.repository(".")
SourceUrl.for_line(repo, "lib/foo.ex", 42)
# => "https://github.com/owner/repo/blob/sha/lib/foo.ex#L42"

# Convenience function
{:ok, url} = SourceUrl.url_for_path("lib/foo.ex", line: 10, end_line: 20)
```

## Next Task

**7.3.1 Path Utilities** - Implement relative path calculation and repository linking.
