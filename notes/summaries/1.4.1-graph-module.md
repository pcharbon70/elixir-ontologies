# Summary: Task 1.4.1 Graph Module

## Overview

Implemented the `ElixirOntologies.Graph` module - a high-level wrapper around `RDF.Graph` that provides a domain-specific API for creating, manipulating, and querying RDF graphs containing Elixir code structure data.

## Changes Made

### New File: `lib/elixir_ontologies/graph.ex`

Created the Graph module with:

**Struct Definition:**
```elixir
defstruct [:graph, :base_iri]

@type t :: %__MODULE__{
  graph: RDF.Graph.t(),
  base_iri: RDF.IRI.t() | nil
}
```

**Core API Functions:**

| Function | Description |
|----------|-------------|
| `new/0` | Create empty graph |
| `new/1` | Create graph with options (base_iri, prefixes, name) |
| `add/2` | Add single statement (triple or RDF.Description) |
| `add_all/2` | Add multiple statements or RDF.Graph |
| `merge/2` | Combine two graphs |
| `subjects/1` | Return all subjects as MapSet |
| `describe/2` | Return RDF.Description for a subject |
| `query/2` | Execute SPARQL query with automatic prefix handling |

**Utility Functions:**

| Function | Description |
|----------|-------------|
| `statement_count/1` | Count statements in graph |
| `empty?/1` | Check if graph is empty |
| `to_rdf_graph/1` | Extract underlying RDF.Graph |
| `from_rdf_graph/2` | Create Graph from existing RDF.Graph |

### New File: `test/elixir_ontologies/graph_test.exs`

52 tests covering:
- Graph creation (new/0, new/1 with options)
- Statement addition (add/2, add_all/2)
- Graph merging
- Query operations (subjects/1, describe/2)
- SPARQL queries with prefix handling
- Utility functions
- 13 doctests

### SPARQL Integration

The `query/2` function automatically:
1. Detects if SPARQL library is available
2. Builds PREFIX declarations from `ElixirOntologies.NS.prefix_map/0`
3. Supports custom prefixes via options
4. Returns `{:ok, result}` or `{:error, reason}`

```elixir
# Example query with automatic prefix handling
{:ok, results} = Graph.query(graph, "SELECT ?s WHERE { ?s a struct:Module }")
```

## Files Changed

- `lib/elixir_ontologies/graph.ex` - New module (350 lines)
- `test/elixir_ontologies/graph_test.exs` - New tests (430 lines)
- `notes/features/1.4.1-graph-module.md` - Updated to complete
- `notes/planning/phase-01.md` - Marked task 1.4.1 complete

## Metrics

| Metric | Value |
|--------|-------|
| Graph Tests | 52 (39 tests + 13 doctests) |
| Total Project Tests | 229 |
| Public Functions | 12 |
| Typespecs | 12 (100%) |
| Lines of Code | ~350 |

## How to Test

```bash
# Run Graph tests
mix test test/elixir_ontologies/graph_test.exs

# Run all tests
mix test
```

## Usage Examples

```elixir
alias ElixirOntologies.Graph
alias ElixirOntologies.NS.Structure

# Create a graph
graph = Graph.new(base_iri: "https://example.org/code#")

# Add statements
graph =
  graph
  |> Graph.add({~I<https://example.org/code#MyApp>, RDF.type(), Structure.Module})
  |> Graph.add({~I<https://example.org/code#MyApp>, Structure.moduleName(), "MyApp"})

# Query subjects
subjects = Graph.subjects(graph)

# SPARQL query
{:ok, results} = Graph.query(graph, "SELECT ?m WHERE { ?m a struct:Module }")
```
