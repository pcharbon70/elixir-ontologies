# Summary: Task 4.4.1 - Macro Definition Extractor

## Overview

Implemented a Macro Definition extractor for Phase 4 that extracts defmacro and defmacrop definitions from AST, including macro name, arity, visibility, parameters, guards, body, and hygiene detection.

## Files Created

### `lib/elixir_ontologies/extractors/macro.ex` (~320 lines)

Main extractor module with:

**Result Struct:**
```elixir
%MacroDefinition{
  name: atom(),
  arity: non_neg_integer(),
  visibility: :public | :private,
  parameters: [Macro.t()],
  guard: Macro.t() | nil,
  body: Macro.t(),
  is_hygienic: boolean(),
  location: SourceLocation.t() | nil,
  metadata: %{
    has_guard: boolean(),
    uses_var_bang: boolean(),
    uses_macro_escape: boolean()
  }
}
```

**Public API:**
- `macro?/1` - Macro detection for defmacro/defmacrop
- `extract/2` - Main extraction from macro AST
- `extract!/2` - Raising variant
- `extract_all/1` - Bulk extraction from module body
- `public?/1` - Check if macro is defmacro
- `private?/1` - Check if macro is defmacrop
- `hygienic?/1` - Check if macro is hygienic
- `has_guard?/1` - Check if macro has guard clause
- `macro_id/1` - Returns "name/arity" string

**Features:**
- Extracts macro name and arity
- Determines visibility (public/private)
- Extracts parameters and guards
- Preserves macro body AST
- Detects hygiene violations (var!, Macro.escape)
- Sets is_hygienic based on body analysis

### `test/elixir_ontologies/extractors/macro_test.exs` (~400 lines)

Comprehensive test coverage:
- Macro detection tests (6 tests)
- defmacro extraction tests (5 tests)
- defmacrop extraction tests (3 tests)
- Hygiene detection tests (3 tests)
- Bulk extraction tests (4 tests)
- Helper function tests (10 tests)
- Error handling tests (5 tests)
- Integration tests with `quote` (4 tests)

## Key Implementation Details

1. **Two Visibility Levels:** defmacro (public) and defmacrop (private) are distinguished by visibility property.

2. **Guard Support:** Macro guards are extracted using the same pattern as function guards - detecting `{:when, _, [call, guard]}` pattern.

3. **Hygiene Detection:** The extractor scans the macro body for:
   - `var!` calls - which break hygiene by allowing variable access across contexts
   - `Macro.escape` calls - which may indicate complex metaprogramming

4. **AST Traversal:** Uses `Macro.prewalk/3` to find specific calls within the macro body.

5. **Consistent Pattern:** Follows the same API pattern as other extractors (extract/2, extract!/2, extract_all/1, helper predicates).

## Test Results

- **Total Tests:** 58 (18 doctests + 40 unit tests)
- **Failures:** 0
- **Dialyzer:** Passes with 0 errors
- **Full Suite:** 2174 tests (584 doctests + 23 properties + 1567 tests), 0 failures

## Ontology Alignment

Supports the following from `elixir-structure.ttl`:
- `Macro` - Base class for macro definitions
- `PublicMacro`, `PrivateMacro` - Visibility subclasses
- `macroName`, `macroArity` properties
- `isHygienic` property for hygiene detection
- `MacroClause` - Individual macro clauses

## Relationship to Other Extractors

This begins Section 4.4 - Macro Extractor:
- **4.4.1 Macro Definition Extractor** - Extracts defmacro/defmacrop (this task)
- **4.4.2 Quote/Unquote Extractor** - Extracts quote blocks and unquote calls (next)

## Next Steps

Task 4.4.2 - Quote/Unquote Extractor:
- Detect `quote do...end` blocks
- Create `QuotedExpression` with `quotesExpression`
- Extract `quoteContext` option (:match, :guard)
- Detect `unquote()` calls as `UnquoteExpression`
- Detect `unquote_splicing()` as `UnquoteSplicingExpression`
- Link via `unquotesValue`
